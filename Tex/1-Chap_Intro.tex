\chapter{绪论}\label{chap:introduction}

\section{选题的背景及意义}
%% 学科背景

%% 问题定义与介绍
光照估计（又称光照分布估计）是从已知的彩色图像信息中，预测、估计、恢复出整个场景的光照分布。
该问题的输入通常是若干张彩色图片，或者是一段视频，有时几何或材质信息也会作为先验知识来辅助估计光照。
场景的光照分布是指场景中各个方向的光照的颜色和强度。
较为常见的光照分布表示方法包括
高动态范围（High Dynamic Range，HDR）全景图、球形谐波（Spherical Harmoins，SH）函数、
基于物理的Sun-Sky模型等。
其中精度最高、使用比较广泛的是HDR全景图像，在实时渲染领域使用较多的是光照的SH表示。 
基于物理的光照表示模型则多用于室外场景。

%% 研究意义、应用场景
光照估计作为计算机图形学和计算机视觉的基础问题之一，有着广泛的实际应用场景。
例如：基于图像的渲染（Image Based Rendering，IBR）、
增强现实（Augmented Reality，AR）、电影后期制作、真实感虚实交互等。
图\ref{fig:demo-problem-define}展示了光照估计的应用之一。
光照估计也与学科中的许多其它问题息息相关。
例如：双向反射分布函数（BRDF）估计、场景几何重构、本征信息提取、图像增强，等等。
而高质量的光照估计结果，通常能够为这些问题的解决带来很大的帮助。
\input{Figures/demo-problem-define.tex} 

%% 难点
从有限的图像信息估计出整个场景的光照分布是一个复杂的问题。
首先，图像的视野范围比较有限，
例如一张视场角（FOV）为60°的照片所拍摄到的区域，在其对应的全景图中占比不足6\%。
此外，一幅图片是光照分布、场景几何结构、物体材质、摄相机参数等多个单位之间的复杂交互结果
（公式~\ref{eq:complex-interaction-result}）。
\begin{equation} \centering \label{eq:complex-interaction-result}
Image = ComplexInteraction(Light, Geometry, Material, Camera)\end{equation}
通过公式\ref{eq:complex-interaction-result}可以看出，
在其它三个信息未知的情况下，从图像（Image）反推出光照（Light）是一个严重的不适定（ill-posed)问题。
不仅如此，在不同的条件下拍摄的彩色图像可能存在很多误差。
例如图像中的过曝光/欠曝光区域、相机畸变、不正确的白平衡等。
这些都会对光照估计造成一定程度的干扰，增加光照估计的难度。

%% 传统方法 + 局限性
研究者们在光照估计问题上开展了一系列的研究。Debevec\cite{debevec1998rendering}
首次提出可以通过拍摄不同曝光下的镜面球体，来获取一张高动态范围的全景图片。
\todo{Related limited methods.} 
不难看出，这些方法或依赖特殊的探针、或依赖特殊的拍摄设备、或依赖额外的辅助信息与模型假设。
均具有一定的局限性。

%% 深度学习方法 + 局限性
近年来，深度学习在多种计算机视觉问题上大放异彩，用于分割、检测、标识、分类的神经网络层出不穷。
一些研究者尝试将深度学习应用在光照估计问题当中。
\todo{Related learning based methods.}
不过，目前已有的深度学习方法也有一定的局限性。训练一个鲁棒的神经网络往往需要大量的数据。
目前用于光照估计问题的数据集比较有限，主要包括：
大规模的低动态范围全景数据集（SUN360等）和中小规模特定场景的高动态范围全景数据集（Laval Indoor等）。
这些数据集在规模和质量上很难同时到达训练深度神经网络的要求。

%% 研究目标和研究方法， 在前人工作的基础上，对网络、loss、优化，数据 展开研究
在这样的背景下，本文构建了一个用于光照估计的数据集。
数据集具有一定的规模和质量，它不仅能被用来训练更加鲁棒的光照估计网络，也可以被应用到其它多种相关的深度学习问题当中。
在已有数据集和本文构建的数据集基础上，本文深入探索了基于深度学习网络的光照估计方法，
对网络结构，损失函数，光照表示等多个模块进行了细致的研究。

\section{国内外研究现状}
\subsection{光照的表示}
光照的表示对光照估计问题至关重要。
场景的光照分布有着多种多样的表示方法。其中
高动态范围（High Dynamic Range，简称HDR)全景图是一种被广泛使用而且精度较高的光照表示方式。
与普通的8位三通道图像不同，HDR图像的颜色值范围可以从0取到非常大。
这意味着HDR图像可以更细致地表示每个像素位置的真实亮度值。
因此无论是HDR全景图表示的光照，还是使用其渲染的物体，都能更接近真实值。
Reinhard在\textit{High Dynamic Range Imaging}\cite{reinhard2010high}中对HDR图像进行了详细的介绍。

%%HDR全景图表示的光照在图像渲染、估计光照等问题中往往比较“繁琐”。
研究者们也提出了一些小巧、高效的光照近似模型，代价是牺牲一部分精度。
Ravi\cite{ramamoorthi2001efficient}提出使用球形谐波函数来表示场景的光照。
这种方法表示的光照，不仅参数规模较小，而且其在渲染物体时非常高效。
他在文章中指出，该模型仅使用9个系数时，在漫反射物体上渲染结果的平均误差也不超过1\%。
不过由于球形谐波函数本身的特性，这种方式不能很好的保留光照分布的高频细节。
尽管如此，它的简洁和高效使得它成为实时渲染中的重要方式之一\cite{green2003spherical,sloan2008stupid}。
许多光照估计方法中采用了这种模型来表示场景的光照分布。
图\ref{fig:lighting-representation}展示了不同的几种光照表示示例。
\input{Figures/lighting-representation}

在室外场景中，光线的主要来源是太阳光以及太阳光在空气和地面的散射与反射。
因此基于物理的光照表示模型更加适合表示室外场景。
Richard\cite{perez1993all}提出了一个参数化的物理模型来表示天空中的发光度（Luminance）分布。
之后的许多工作
~\cite{nishita1996display, sirai1993display, preetham1999practical,raab2008unbiased}
考虑了空气散射和折射、大气浑浊度的影响，将该模型扩展为多种不同类型颜色模型。
Hosek~\cite{hosek2012analytic, hovsekhovsek2013adding}基于这些工作，
考虑并加入了多种因素，整理出一个可调节太阳位置、大气浑浊度、地面反照率的物理参数模型。
这类模型的参数量较小，精度也很可观，因此成了在室外光照估计中常用的光照表示方法。


光照分布也有很多其它的表示方式。
Ng\cite{ng2003all}提出使用小波函数来近似光照分布。
LeGendre\cite{legendre2016practical}提出了一个实用的框架，
能够使用LED灯台精确地重构出各个方向的场景光照。
近期Weber\cite{weber2018learning}结合深度学习，
使用自编码器（auto-encoder）对光照分布进行建模，为光照估计问题提供了新的思路。

\subsection{光照估计问题的提出}
对于光照估计来说，估计出高精度的HDR全景图通常较难。
本节介绍了国内外研究中主要的光照估计方法。
光照估计是一个复杂的问题，研究者们常常采用这些方法中的某种或多种组合，来实现不同的应用需求。

\subsection{使用探测器估计光照}
光照估计是一个复杂的问题，研究者们常常采用多种方法的组合来解决这个问题。
使用探测器（probe）来估计光照就是这些方法之一，而且是光照估计工作中最常用的方法。
常见的光照估计探测器（light probe）包括：
镜面球体，漫反射球体，镜面反射/漫反射混合球体，人脸等等

测量时需要使用特殊的拍摄设备（如多曝光相机）或者特定的探测器（如镜面球体）。
Debevec\cite{debevec1998rendering}
首次提出可以通过拍摄不同曝光下的镜面球体，来获取一张高动态范围的全景图片。
在之后的工作中，Reinhard\cite{reinhard2010high}和Debevec\cite{debevec2012single}指出，
使用一个漫反射或者漫反射与镜面反射混合的球体，也可以达到同意的效果。
\subsection{使用更多的输入信息估计光照}
\subsection{使用约束模型估计光照}
\subsection{深度学习与光照估计的结合}
深度学习与光照估计的结合是主流趋势之一。
章节\ref{sec:learning-based-estimation}对基于深度学习的光照估计方法进行详细的介绍和讨论。

\subsection{应用深度学习的光照估计方法}
\label{sec:learning-based-estimation}
\subsubsection{深度学习}
\subsubsection{利用深度学习工具估计光照}
\subsection{光照估计相关数据集}